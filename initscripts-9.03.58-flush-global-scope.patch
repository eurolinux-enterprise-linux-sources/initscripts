From d59202d1d37c23126e17f8bc05d8a05d059b72a0 Mon Sep 17 00:00:00 2001
From: Lukas Nykryn <lnykryn@redhat.com>
Date: Thu, 30 Jun 2016 07:42:41 +0200
Subject: [PATCH] ifdown-eth: we need to flush global scope as well but it is
 stuck some time

---
 sysconfig/network-scripts/ifdown-eth | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/sysconfig/network-scripts/ifdown-eth b/sysconfig/network-scripts/ifdown-eth
index 89cd8d1..8d8bad6 100755
--- a/sysconfig/network-scripts/ifdown-eth
+++ b/sysconfig/network-scripts/ifdown-eth
@@ -111,7 +111,10 @@ if [ -d "/sys/class/net/${REALDEVICE}" ]; then
                LABEL="label ${DEVICE}"
         fi
 	if [ "${REALDEVICE}" = "lo" ]; then
-		ip addr flush dev ${REALDEVICE} ${LABEL} scope host 2>/dev/null
+                TIMEOUT=""
+                [ -x /usr/bin/timeout ] && TIMEOUT="/usr/bin/timeout --signal=SIGQUIT 4"
+		$TIMEOUT ip addr flush dev ${REALDEVICE} ${LABEL} scope global 2>/dev/null
+		$TIMEOUT ip addr flush dev ${REALDEVICE} ${LABEL} scope host 2>/dev/null
 	else
 		ip addr flush dev ${REALDEVICE} ${LABEL} scope global 2>/dev/null
 		ip -4 addr flush dev ${REALDEVICE} ${LABEL} scope host 2>/dev/null
-- 
2.9.3

